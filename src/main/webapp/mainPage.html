<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
</head>
<style>
    body {
        background-color: #f2f2f2;
    }
    form {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 0 10px #ccc;
        padding: 20px;
        width: 300px;
        margin: 0 auto;
    }
    form input {
        width : 100%;
        display: block;
        margin: 10px 0;
    }
    form input[type="submit"] {
        background-color: #4CAF50;
        border: none;
        color: #fff;
        padding: 10px;
        width: 100%;
    }
    form input[type="submit"]:hover {
        cursor: pointer;
    }
</style>
<body onload="getPosts()">
    <form action="http://summer22-sps-39.wl.r.appspot.com/new-post" method="post">
        <input name = "content">
        <input name = "userId" style="display:none" id="owner_id">
        <input type="submit" value="submit">
    </form>
    <hr>
    <p>Unreplied Post:</p>
    <div id="unReplyWrapper">

    </div>
    <hr>
    <p>Replied Post:</p>
    <div id="repliedWrapper">

    </div>

<script>
    //get id parameter from url
    async function getPosts()
    {
        
        console.log(document.cookie);
        console.log("getPosts()");
        //get cookie
        var cookie = document.cookie;
        //get id from cokie
        var matchId = document.cookie.match(new RegExp('(^| )' + "user_id" + '=([^;]+)'));
        var user_id = matchId[2];
        var matchPassword = document.cookie.match(new RegExp('(^| )' + "password" + '=([^;]+)'));
        var password = matchPassword[2];
        var url = window.location.href;
        var owner_id = url.substring(url.indexOf("?") + 1);
        owner_id=owner_id.split("=")[1];
        document.getElementById("owner_id").value = owner_id;
        console.log (user_id);
        console.log (owner_id);
        if (owner_id) {
            var repliedResults = await fetch("http://summer22-sps-39.wl.r.appspot.com/display-posts", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "owner_id": owner_id,
                },
            })
            var repliedResultsJson = await repliedResults.json();
            console.log(repliedResultsJson);
            var repliedWrapper = document.getElementById("repliedWrapper");
            repliedWrapper.innerHTML = "";
            for (var i = 0; i < repliedResultsJson.length; i++) {
                var repliedDiv = document.createElement("div");
                repliedDiv.className = "repliedDiv";
                var message = document.createElement("ul");
                message.innerHTML = repliedResultsJson[i][0];
                message.className = "message";

                //create response form
                var responseForm = document.createElement("form");
                responseForm.action = "http://summer22-sps-39.wl.r.appspot.com/reply-post";
                responseForm.method = "post";
                var responseInput = document.createElement("input");
                responseInput.name = "content";
                responseInput.type = "text";
                responseInput.placeholder = "reply";
                
                var responseOwnerId = document.createElement("input");
                responseOwnerId.name = "ownerId";
                responseOwnerId.type = "hidden";
                responseOwnerId.value = repliedResultsJson[i][1];

                var responsePostId = document.createElement("input");
                responsePostId.name = "postId";
                responsePostId.type = "hidden";
                responsePostId.value = repliedResultsJson[i][2];

                var originalContent = document.createElement("input");
                originalContent.name = "originalContent";
                originalContent.type = "hidden";
                originalContent.value = repliedResultsJson[i][0];

                var responseSubmit = document.createElement("input");
                responseSubmit.type = "submit";
                responseSubmit.value = "Submit";


                responseForm.appendChild(message);
                responseForm.appendChild(responseInput);
                responseForm.appendChild(responseOwnerId);
                responseForm.appendChild(responsePostId);
                responseForm.appendChild(originalContent);
                responseForm.appendChild(responseSubmit);
                repliedDiv.appendChild(responseForm);
                repliedWrapper.appendChild(repliedDiv);

            }

        }
    }

    
</script>
</body>
</html>